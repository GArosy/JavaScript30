<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Type Ahead ğŸ‘€</title>
  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <form class="search-form">
    <input type="text" class="search" placeholder="è¯—å¥ è¯—å è¯—äºº" />
    <ul class="suggestions">
      <li>è¾“å…¥è¯å¥ï¼Œæ‰¾ä¸€é¦–è¯—</li>
      <li></li>
    </ul>
  </form>
  <script>
    const endpoint =
      "https://gist.githubusercontent.com/soyaine/81399bb2b24ca1bb5313e1985533c640/raw/bdf7df2cbcf70706c4a5e51a7dfb8c933ed78878/TangPoetry.json";
    // jsonè½¬æ•°ç»„
    const poetryList = [];
    fetch(endpoint)
      .then(response => response.json())
      .then(response => {poetryList.push(...response);console.log('èµ„æºè·å–å®Œæˆ')});
    // console.log(poetryList); // fetchæ˜¯å¼‚æ­¥è¯·æ±‚ï¼Œæ‰“å°ä¸ºç©ºå€¼

    // è¾“å…¥å¤„ç†å‡½æ•°
    const inputHandle = function (input, poetryList) {
      return poetryList.filter((poet) => {
        // æ­£åˆ™æ‰¾å‡ºåŒ¹é…çš„è¯—
        const regex = new RegExp(input, 'ig');
        // jsonçš„ä½œè€…æ•°æ®æ•°ç»„å½¢å¼ï¼Œé¡»è½¬æ¢ä¸ºå­—ç¬¦ä¸²
        const author = poet.detail_author.join('');
        // console.log(author);
        return (
          poet.title.match(regex) ||
          poet.detail_text.match(regex) ||
          author.match(regex)
        )
      })
    }

    // è¾“å‡ºå¤„ç†å‡½æ•°
    const outputHandle = function () {
      // åˆ¤æ–­inputæ˜¯å¦ä¸ºç©ºå€¼
      if (!this.value) {
        return
      }
      // æ‹¿åˆ°åŒ¹é…ä¹‹åçš„è¯—æ•°ç»„
      const result = inputHandle(this.value, poetryList);
      // console.log(result);
      const regex = new RegExp(this.value,"ig");
      const html = result.map((item)=>{
        // å°†æ§åˆ¶é«˜äº®çš„htmlä»£ç åŠ å…¥åŸè¯—å¥ï¼Œé«˜äº®åŒ¹é…åˆ°çš„è¯å¥
        const poetText = item.detail_text.replace(regex, 
        `<span class="hl">${this.value}</span>`);
        const title = item.title.replace(regex, 
        `<span class="hl">${this.value}</span>`);
        const author = item.detail_author.join('').replace(regex, 
        `<span class="hl">${this.value}</span>`);
        // æ„é€ html
        return `
          <li>
            <span class="poet">${poetText}</span>
            <span class="title">${title} â€”â€” ${author}</span>
          </li>
        `
      })
      .join('');  // mapè¿”å›æ•°ç»„ï¼Œéœ€è½¬æ¢ä¸ºå­—ç¬¦ä¸²æ‰èƒ½å†™å…¥html
      // console.log(html);
      // å†™å…¥html
      suggestions.innerHTML = html;

    }

    // è·å–å…ƒç´ ï¼Œæ·»åŠ ç›‘å¬äº‹ä»¶
    const search = document.querySelector(".search");
    const suggestions = document.querySelector(".suggestions");
    search.addEventListener('input', outputHandle, false);
  </script>
</body>

</html>