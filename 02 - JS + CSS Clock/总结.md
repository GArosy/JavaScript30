# 02 纯 JS、CSS 时钟 总结

## 改进

相比原例：

- 增加了秒针音效（点击触发）；
- 调整初始指针位置到12点钟，略微修改一些css细节；

## 实现要点

- 简洁精准的表盘及指针
  - css涉及`position`、`margin`负值偏移元素位置，`:after`伪元素，
- 连贯顺畅的指针动画
  - css涉及`transition`、`cubic-bezier`属性
  - js涉及指针转动的策略选择
- 音效加载
  - html涉及`audio`标签的使用
  - js中需要额外添加触发事件
- 性能
  - 减少访问DOM的次数

## 坑

- 如果一开始就选择实时创建Date()对象，实时设定旋转角度这一策略，那么当秒针旋转一圈之后回到初始位置，开始第二圈旋转时（354° → 0° → 6°），这一秒的动画会经历一个逆时针旋转一周的归零动作，再继续顺时针旋转，由于秒针变换时间很短，所以呈现的效果就是秒针跳顿。

  若想解决这个bug，只能对59秒处的动画做出牺牲，设置这一秒的动画过渡时间transition为0，但这样时针会出现较大幅度的跳跃。

- 我们可以改变实现的策略，只在页面第一次加载时 new 一次 Date 对象，此后每秒直接更新角度值。这样秒针的角度永远是连续增大的，动画也永远是连续的。

  但这样也有一个问题，当秒值一直增加到100000000这样的大整数时，由于js的特性，此时会秒针会失去精度。为解决此问题，可以在秒数为86400（一天）时让秒数归零：

  ```js
  if (secondDeg == 86400) {secondDeg = 0};
  ```

- Chrome在2018年禁止了网页自动播放音频以增强安全性。所以直接在js或html中显式调用audio播放声音都会使浏览器报错。如果需要自动播放媒体内容，可以静音播放或通过用户的交互动作触发播放。